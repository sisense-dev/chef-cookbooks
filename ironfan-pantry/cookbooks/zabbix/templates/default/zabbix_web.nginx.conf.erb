# Generated by Chef

upstream zabbix_web {
<%- @node[:zabbix][:web][:num_daemons].times.each do |i| -%>
  server unix:<%= node[:zabbix][:web][:tmp_dir] %>/php-<%= i %>.sock max_fails=3 fail_timeout=10s;
<%- end -%>
}

server {
  listen <%= node[:zabbix][:web][:port] %>;
  server_name <%= node.zabbix.web.fqdn %> _ ;
  access_log <%= node.zabbix.web.log_dir %>/nginx.access.log;
  error_log  <%= node.zabbix.web.log_dir %>/nginx.error.log;
  
  root <%= node.zabbix.web.home_dir %>;

  location / {
    index index.html index.php;
  }

  location ~ \.php$ {
    include fastcgi_params;
    fastcgi_param SERVER_NAME $host;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_pass zabbix_web;
  }
}